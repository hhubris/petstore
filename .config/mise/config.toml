[tools]
go = "latest"
"golangci-lint" = "latest"

[tasks.generate]
description = "Generate server and client code from OpenAPI spec"
run = "cd {{config_root}} && go generate ./internal/api/..."

[tasks.db]
description = "Start database and run migrations"
depends = ["db:start", "db:migrate"]

[tasks."db:start"]
description = "Start PostgreSQL container with persistent volume"
run = """
docker run --name petstore-db \
  -e POSTGRES_PASSWORD="$POSTGRES_PASSWORD" \
  -v petstore-data:/var/lib/postgresql \
  -p 5432:5432 \
  -d docker.io/library/postgres:latest
"""

[tasks."db:stop"]
description = "Stop and remove the PostgreSQL container"
run = "docker rm -f petstore-db"

[tasks."db:clean"]
description = "Stop container and remove persistent volume"
run = """
docker rm -f petstore-db 2>/dev/null || true
docker volume rm petstore-data 2>/dev/null || true
"""

[tasks."db:migrate"]
description = "Run database migrations"
depends = ["db:start"]
run = "{{config_root}}/scripts/migrate.sh"

[tasks."api:test"]
description = "Run Go tests"
run = "go test ./..."

[tasks."go:lint"]
description = "Run golangci-lint on Go source"
run = "golangci-lint run ./..."

[tasks.lint]
description = "Run all linters"
depends = ["go:lint"]
